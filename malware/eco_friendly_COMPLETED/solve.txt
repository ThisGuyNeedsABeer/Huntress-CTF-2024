Name: Eco-Friendly
Value: 412 points
Category: Malware
Solves: 134 Solves -
Author: @JohnHammond

Description:
This sample is good for the environment!

Download the file(s) below.
Attachments: eco_friendly

Solution:

** Note: I had issues breaking this down on FlareVM and ended up using a regular Windows VM
		 on FlareVM all of my letter "l's" were being decoded as ";'s" making for a real
		 interesting time in VSCode **

1. Download and inspect the file and discover it's a Powershell file

2. Start defanging the malware changing all "IEX" to "Write-Host"

	a. On FlareVM, due to the customizations, the script may not decode right.

3. I decoded eco_friendly > stage2.ps1

	a. Due to long lines, please refer to the associated file. 

4. I decoded stage2.ps1 > stage3.ps1

	a. Due to long lines, please refer to the associated file. 

4. I decoded stage3.ps1 -> stage4.ps1

Write-Host ('{39}{23}{26}{13}{21}{16}{17}{14}{27}{9}{22}{3}{12}{1}{5}{20}{8}{38}{37}{7}{30}{6}{34}{11}{18}{4}{36}{19}{0}{24}{28}{32}{40}{35}{31}{25}{29}{33}{2}{15}{10}' -f [char]55,$env:ComSpec[22],[char]54,[char]52,$env:PUBLiC[11],$env:ProgramFiles[14],[char]56,[char]53,$env:ComSpec[15],$env:PUBLiC[11],[char]125,$env:Comspec[22],$env:Comspec[17],[char]102,[char]123,$env:Comspec[17],$env:ProgramFiles[8],$env:CommonProgramFiles[6],$env:PUBLiC[11],[char]55,[char]49,$env:ProgramFiles[13],$env:ProgramData[11],[char]35,$env:Comspec[18],$env:ComSpec[17],$env:CommonProgramFiles[10],[char]56,$env:Comspec[18],[char]57,$env:Comspec[18],$env:Comspec[18],$env:PUBLiC[5],$env:CommonProgramW6432[8],[char]55,[char]49,[char]102,[char]57,[char]48,$env:CommonProgramW6432[23],[char]53)

5. Executing stage4.ps1 revealed the flag

PS C:\CTF> C:\CTF\stage4.ps1
 # flag{8ba43de1e095287dbbf7722e51239a63}

6. Flag: flag{8ba43de1e095287dbbf7722e51239a63}

