Name: Rustline
Value: 484 points
Category: Malware
Solves: 58 Solves
Author: @HuskyHacks

Description:

Jerry: A Redline Stealer.
George: Written in Rust.
Jerry: A Rusty Redline Stealer.
George: A Rusty Redline Stealer, Jerry!

We caught a Redline variant executing on an endpoint and intercepted the encrypted files as they traversed the edge proxy. Well, everything except for the flag.txt file (imagine that...). Any chance you could figure out how this thing works and recover the flag? NOTE: Archive password is rustline

Download the file(s) below.
Attachments: challenge.zip

Solution:

1. Download and extract the challenge files, and find 2 folders and one .scr file. 
   analyzing this file we can see it is a Windows PE file.

┌──(kali㉿kali2024)-[~/CTF/huntress2024/malware/rustline]
└─$ ls
Application.docx.scr  challenge-files  challenge.zip  encrypted-files
                                                                                                                                                                                                                                            
┌──(kali㉿kali2024)-[~/CTF/huntress2024/malware/rustline]
└─$ file Application.docx.scr                    
Application.docx.scr: PE32+ executable (console) x86-64 (stripped to external PDB), for MS Windows, 10 sections
                                                                                                                                                                                                                                            
2. Given that we have encrypted, and unencrypted files, my first guess is to check
   for XOR encryption before even cracking open the PE in Ghidra

3. Using a script I had from a previous challenge (praise the AI overlords), I plugged in the path to
   and encrypted passwords.txt file, and an unencrypted passwords.txt file. I was able to recover the following key.

┌──(kali㉿kali2024)-[~/CTF/huntress2024/malware/rustline]
└─$ python xor_key_recovery_from_file_pair.py 
Derived XOR key: b8f72ff695587745b08fdc8ee71adf7eb8f72ff695587745b08fdc8ee71adf7eb8f72ff695587745b08f
Detected repeating XOR key: b8f72ff695587745b08fdc8ee71adf7e

4. Having AI write me an XOR decryption routine, we try that key on the flag.txt file and cat the output.
                                                                                                                                                                                                                         
┌──(kali㉿kali2024)-[~/CTF/huntress2024/malware/rustline]
└─$ python solve.py                          
Decryption completed. Output saved to /home/kali/CTF/huntress2024/malware/rustline/encrypted-files/flag_decrypted.txt

┌──(kali㉿kali2024)-[~/CTF/huntress2024/malware/rustline]
└─$ cat /home/kali/CTF/huntress2024/malware/rustline/encrypted-files/flag_decrypted.txt
"Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt. Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem. Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur? Quis autem vel eum iure reprehenderit qui in ea voluptate velit esse quam nihil molestiae consequatur, vel illum qui dolorem eum fugiat quo voluptas nulla pariatur?"

flag{bfe12aadd139def4d47f5f51a539249d}

"Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt. Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem. Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur? Quis autem vel eum iure reprehenderit qui in ea voluptate velit esse quam nihil molestiae consequatur, vel illum qui dolorem eum fugiat quo voluptas nulla pariatur?"    

5. Flag: flag{bfe12aadd139def4d47f5f51a539249d}